{% extends 'base.html' %}   
{% load static %}



{% block extra_css %}
<link rel="stylesheet" href="{% static 'caja/css/caja.css' %}">
{% endblock %}

{% block title %}Abrir Caja{% endblock %}

{% block content %}
<h1 class="titulo-abrir-caja">Abrir Caja</h1>

<form id="form-abrir-caja" class="form-abrir-caja">
    {% csrf_token %}
    <div class="form-container-abrir-caja">
        <label for="fecha-abrir-caja" class="label-abrir-caja">Fecha:</label>
        <input type="date" id="fecha-abrir-caja" name="fecha" class="input-abrir-caja">

        <label for="hora-abrir-caja" class="label-abrir-caja">Hora:</label>
        <input type="time" id="hora-abrir-caja" name="hora" class="input-abrir-caja">

        <label for="monto-abrir-caja" class="label-abrir-caja">Monto Inicial:</label>
        <input type="number" id="monto-abrir-caja" name="monto" class="input-abrir-caja" placeholder="Monto Inicial">

        <label for="responsable-abrir-caja" class="label-abrir-caja">Responsable:</label>
        <input type="text" id="responsable-abrir-caja" name="responsable" class="input-abrir-caja" placeholder="Responsable">

        <button type="button" id="btn-abrir-caja" class="btn-abrir-caja">Abrir Caja</button>
        <button type="button" id="btn-volver" class="btn-volver">⬅️ Volver</button>
    </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    async function abrirCaja() {
        const fecha = document.getElementById('fecha-abrir-caja').value.trim();
        const hora = document.getElementById('hora-abrir-caja').value.trim();
        const monto = document.getElementById('monto-abrir-caja').value.trim();
        const responsable = document.getElementById('responsable-abrir-caja').value.trim();

        if (!fecha || !hora || !monto || !responsable) {
            alert("⚠️ Todos los campos son obligatorios");
            return;
        }

        try {
            const response = await fetch("{% url 'caja:abrir_caja_ajax' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ fecha, hora, monto, responsable })
            });
            const data = await response.json();

            if (response.ok) {
                alert(data.mensaje || "Caja abierta correctamente ✅");
                document.getElementById('form-abrir-caja').reset();
                window.location.href = "{% url 'caja:caja_home' %}";
            } else {
                alert(data.mensaje || "Error al abrir la caja ❌");
            }

        } catch (err) {
            console.error(err);
            alert("Error al procesar la solicitud ❌");
        }
    }

    document.getElementById('btn-abrir-caja').addEventListener('click', abrirCaja);
    document.getElementById('btn-volver').addEventListener('click', () => {
        window.location.href = "{% url 'caja:caja_home' %}";
    });
});
</script>
{% endblock %}
