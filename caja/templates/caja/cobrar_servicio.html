{% extends 'base.html' %}
{% load static %}
{% block title %}Cobrar Servicio{% endblock %}


{% block content %}
<h1 class="titulo-cobrar-servicio">Cobrar Servicio</h1>

<form id="form-cobrar-servicio" class="form-cobrar-servicio">
    <div class="form-container-cobrar">
        <label for="paciente-cobrar" class="label-cobrar">Paciente:</label>
        <input type="text" id="paciente-cobrar" name="paciente" class="input-cobrar" placeholder="Nombre del Paciente">

        <label for="servicio-cobrar" class="label-cobrar">Servicio:</label>
        <input type="text" id="servicio-cobrar" name="servicio" class="input-cobrar" placeholder="Servicio">

        <label for="monto-cobrar" class="label-cobrar">Monto:</label>
        <input type="number" id="monto-cobrar" name="monto" class="input-cobrar" placeholder="Monto">

        <label for="pago-cobrar" class="label-cobrar">Método de Pago:</label>
        <input type="text" id="pago-cobrar" name="pago" class="input-cobrar" placeholder="Método de Pago">

        <button type="button" id="btn-cobrar-servicio" class="btn-cobrar">Cobrar</button>
        <button type="button" id="btn-volver" class="btn-volver">⬅️ Volver</button>
    </div>
</form>

<style>
    .titulo-cobrar-servicio {
    text-align: center;
    color: #004080;
    margin-bottom: 20px;
}

.form-container-cobrar {
    max-width: 500px;
    margin: 0 auto;
    padding: 20px;
    background: #f4f4f4;
    border-radius: 10px;
    box-shadow: 0px 2px 10px rgba(0,0,0,0.1);
}

.label-cobrar {
    display: block;
    margin-top: 15px;
    margin-bottom: 5px;
    font-weight: bold;
    color: #333;
}

.input-cobrar {
    width: 100%;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ccc;
}

.btn-cobrar, .btn-volver {
    margin-top: 20px;
    padding: 10px 20px;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s;
}

.btn-cobrar {
    background-color: #0066cc;
    margin-right: 10px;
}

.btn-cobrar:hover {
    background-color: #004080;
}

.btn-volver {
    background-color: #888;
}

.btn-volver:hover {
    background-color: #555;
}

</style>

<script>
async function cobrarServicio() {
    const paciente = document.getElementById('paciente-cobrar').value.trim();
    const servicio = document.getElementById('servicio-cobrar').value.trim();
    const monto = document.getElementById('monto-cobrar').value.trim();
    const pago = document.getElementById('pago-cobrar').value.trim();

    if (!paciente || !servicio || !monto || !pago) {
        alert("Todos los campos son obligatorios.");
        return;
    }

    try {
        const response = await fetch("{% url 'caja:cobrar_servicio_ajax' %}", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: JSON.stringify({paciente, servicio, monto, pago})
        });

        const data = await response.json();

        if(response.ok){
            alert(data.mensaje);
            document.getElementById('form-cobrar-servicio').reset();
        } else {
            alert(data.mensaje || "Error al cobrar el servicio");
        }
    } catch (error) {
        console.error(error);
        alert("Ocurrió un error al procesar la solicitud.");
    }
}

// Botón Cobrar
document.getElementById('btn-cobrar-servicio').addEventListener('click', cobrarServicio);

// Botón Volver
document.getElementById('btn-volver').addEventListener('click', () => {
    window.location.href = "{% url 'caja:caja_home' %}";
});
</script>

{% endblock %}
